---
title: CPI Production Systems
subtitle: Survey Analysis

author:
  - name: Collin Brown
    affiliation: Statistics Canada
  - name: Steve Martin
    affiliation: Statistics Canada
---

## Upfront Admin

::: {layout-ncol=2}
Survey created on behalf of the [Task Team on Scanner Data](https://unstats.un.org/bigdata/task-teams/scanner/index.cshtml) under the [UN Committee of Experts on Big Data and Data Science for Official Statistics](https://unstats.un.org/bigdata/).

Thank you for the helpful feedback and numerous contributions from our colleagues in the **Workstream on CPI Systems Architecture**
:::

![](https://unstats.un.org/bigdata/assets/img/logo/logo_2021_long.png)

**Note**: The full report can be found [here]().


## CPI Production Systems Background

- CPI Production Systems involve significant amounts of **code**, **documentation**, and **other non-code artifacts** (e.g., Excel Workbooks).

- These systems carry out complex business logic in order to **transform input data into output data**.

- These systems are often developed entirely or in large part by people **with domain expertise but without training in software engineering**.

## Why Run This Survey?

1. Many CPI Production Systems teams **struggle with managing system complexity**.

2. State of CPI Production Systems around the world is **unknown** (e.g., how are systems organized, how often are systems updated).

3. Provide **practical advice** based on the current state of systems.

## Related Work

A lot of related work is from the world of software engineering. **Notable Examples**:

- [Team Topologies](https://teamtopologies.com/) (@skelton2019team) looks at how to optimally organize teams.

- [Accelerate: The State of DevOps Report](https://cloud.google.com/devops/state-of-devops) (@forsgren2018accelerate) shares ideas around how to measure software delivery performance.

- [Data Mesh Architecture](https://www.datamesh-architecture.com/) (@dehghani2022data) introduces architecture concepts oriented around domain-aligned data product teams.

- [Reproducible Analytical Pipelines (RAP) Community of Practice](https://nhsdigital.github.io/rap-community-of-practice/) (@RAPsite) shares tools, principles, and techniques to create more robust analytical systems.

## Survey Concepts

Goal is to characterize system layout, team organization, tool use, and system performance metrics.

How to articulate germane aspects of system architecture in a short survey?

    - Need to introduce a simple conceptual model to communicate key system ideas.

## Survey Concepts - Systems

![](diagrams/gsbpm-systems.drawio.png){width=50% fig-align="center"}

We define a **system** as any indivisible (atomic) software component that takes **one or more data inputs** and produces **one or more data outputs**.

## Survey Concepts - Teams

A **team** is defined as a **group of individuals** who **maintain** one or more **systems**. 

| Team Type | Description |
| --------- | ----------- |
| Corporate IT | IT professionals **not in** the price statistics team. |
| Domain-Embedded IT | IT professionals **in** the price statistics team. |
| Domain-Embedded Analysts | non-IT professionals **in** the price statistics team. |
| Non-Domain Analysts | non-IT professionals **not in** the price statistics team.
| External Consultants or Contractors | Professionals outside of the organization to whom work is contracted. |

## Survey Concepts - Flow of Change

From left to right, we go from raw data to the production of the CPI.

![Flow of Change](./diagrams/gsbpm-systems-2.drawio.svg){#fig-flow-of-work width="90%"}

Flow of change based loosely on the General Statistical Business Process Model (GSBPM).

## Survey Concepts - Monolithic vs. Modular Architectures

::: {layout-ncol=2}
![Perfect Monolith Example](./diagrams/gsbpm-monolith.drawio.svg){#fig-monolith height="30%"}

![Perfect Modular Example](./diagrams/gsbpm-modular.drawio.svg){#fig-modular height="30%"}
:::

## Results - Which Steps are Systems Coupled Across?

![Conceptual diagram of loose and high coupling. Source: https://en.wikipedia.org/wiki/Coupling_(computer_programming)](https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/CouplingVsCohesion.svg/330px-CouplingVsCohesion.svg.png){width="40%"}

**Question**: To what extent do distinct software modules depend on each other?

## Results - Which Steps are Systems Coupled Across?
```{r}
#| echo: false
#| warning: false
# -------------------
# Dataframe setup
# -------------------

library(dplyr)

# Load results
df <- read.csv("./data/results.csv")  #[,67:116]
# Drop any incomplete responses
df <- df[df[,2] != "",]

# Helpers.
is_yes <- function(x) x == "Yes"

as_steps_matrix <- function(x, rows) {
  dn <- list(rows, c("Ingest", "Process", "Elementals", "Aggregate", "Finalize"))
  list(matrix(!is.na(x), ncol = 5, byrow = TRUE, dimnames = dn))
}

# Turn Q1 into a logical matrix.
crossings_Q1 <-df[df[,15] == "Yes",] |>
  rowwise() |>
  mutate(steps = as_steps_matrix(c_across(16:40), paste0("System ", 1:5)))

# Find 3 clusters.
clusters <- crossings_Q1 |>
  pull(steps) |>
  lapply(as.numeric) |>
  do.call(what = rbind) |>
  kmeans(3)


# How many times do we see **only** Ingestion and Processing, but not the other three?
ing_proc_crossings = 0
proc_elem_crossings = 0
elem_agg_crossings = 0
agg_fin_crossings = 0
ing_proc_elem_x = 0
proc_elem_agg_x = 0
elem_agg_fin_x = 0
first_4_x = 0
last_4_x = 0
all_5_x = 0
# Partition the Q3 matrices by cluster.
for (mat in crossings_Q1$steps) {
  for (ix in 1:5) {
    if (all(mat[ix,] == c(TRUE, TRUE, FALSE, FALSE, FALSE))) {
      ing_proc_crossings <- ing_proc_crossings + 1
    }
    if (all(mat[ix,] == c(FALSE, TRUE, TRUE, FALSE, FALSE))) {
      proc_elem_crossings <- proc_elem_crossings + 1
    }
    if (all(mat[ix,] == c(FALSE, FALSE, TRUE, TRUE, FALSE))) {
      elem_agg_crossings <- elem_agg_crossings + 1
    }
    if (all(mat[ix,] == c(FALSE, FALSE, FALSE, TRUE, TRUE))) {
      agg_fin_crossings <- agg_fin_crossings + 1
    }
    if (all(mat[ix,] == c(TRUE, TRUE, TRUE, FALSE, FALSE))) {
      ing_proc_elem_x <- ing_proc_elem_x + 1
    }
    if (all(mat[ix,] == c(FALSE, TRUE, TRUE, TRUE, FALSE))) {
      proc_elem_agg_x <- proc_elem_agg_x + 1
    }
    if (all(mat[ix,] == c(FALSE, FALSE, TRUE, TRUE, TRUE))) {
      elem_agg_fin_x <- elem_agg_fin_x + 1
    }
    if (all(mat[ix,] == c(TRUE, TRUE, TRUE, TRUE, FALSE))) {
      first_4_x <- first_4_x + 1
    }
    if (all(mat[ix,] == c(FALSE, TRUE, TRUE, TRUE, TRUE))) {
      last_4_x <- last_4_x + 1
    }
    if (all(mat[ix,] == c(TRUE, TRUE, TRUE, TRUE, TRUE))) {
      all_5_x <- all_5_x + 1
    }
  }
}
# split(crossings_Q1$steps, clusters$cluster)
```

| Data ingestion | Data processing | Elementary indexes | Aggregation | Finalization | Frequency |
| ----- | ----- | ---- | ----- | ----- | ---- |
| ✅ | ✅ | ❌ | ❌ | ❌ | `r ing_proc_crossings` |
| ✅ | ✅ | ✅ | ❌ | ❌ | `r ing_proc_elem_x` |
| ❌ | ✅ | ✅ | ✅ | ❌ | `r proc_elem_agg_x` |
| ✅ | ✅ | ✅ | ✅ | ✅ | `r all_5_x` |

## Results - Which Team Combinations are Common Within the Flow of Change?

```{r}
#| echo: false
#| warning: false

# Turn Q2 into a logical matrix.
crossings_Q2 <- df |>
  rowwise() |>
  mutate(steps = as_steps_matrix(
    c_across(42:66),
    c(
      "Corp. IT",
      "Domain IT",
      "Domain Analyst",
      "Other Analyst",
      "Consultant"
    )
  ))

# Find 3 clusters.
clusters <- crossings_Q2 |>
  pull(steps) |>
  lapply(as.numeric) |>
  do.call(what = rbind) |>
  kmeans(3)


# How many times do we see **only** Ingestion and Processing, but not the other three?
d_analyst_only = 0
stream_aligned = 0
cit_only = 0
dit_only = 0
it_only = 0
cit_d_analyst = 0
# Partition the Q3 matrices by cluster.
for (mat in crossings_Q2$steps) {
  for (ix in 1:5) {
    if (all(mat[,ix] == c(FALSE, FALSE, TRUE, FALSE, FALSE))) {
      d_analyst_only <- d_analyst_only + 1
    }
    if (all(mat[,ix] == c(FALSE, TRUE, TRUE, FALSE, FALSE))) {
      stream_aligned <- stream_aligned + 1
    }
    if (all(mat[,ix] == c(TRUE, FALSE, FALSE, FALSE, FALSE))) {
      cit_only <- cit_only + 1
    }
    if (all(mat[,ix] == c(FALSE, TRUE, FALSE, FALSE, FALSE))) {
      dit_only <- dit_only + 1
    }
    if (all(mat[,ix] == c(TRUE, TRUE, FALSE, FALSE, FALSE))) {
      it_only <- it_only + 1
    }
    if (all(mat[,ix] == c(TRUE, FALSE, TRUE, FALSE, FALSE))) {
      cit_d_analyst <- cit_d_analyst + 1
    }
  }
}
# split(crossings_Q1$steps, clusters$cluster)

```

| Corporate IT | Domain IT | Domain Analysts | Other Analysts | Consultants | Team Type | Frequency |
| ----- | ----- | ---- | ----- | ----- | ---- | ---- |
| ❌ | ❌ | ✅ | ❌ | ❌ | Domain Analysts | `r d_analyst_only` |
| ❌ | ✅ | ✅ | ❌ | ❌ | Domain Analysts & Domain IT | `r stream_aligned` |
| ✅ | ❌ | ✅ | ❌ | ❌ | Corp. IT & Domain Analysts | `r cit_d_analyst` |

## Results - Version Control System Use

TODO: insert chart

## Results - Commercial Software Use

TODO: insert chart

## Results - Project Management Software Use

TODO: insert chart

## Results - Programming Language Use (Monolith vs. Modular)

TODO: insert chart

## Results - Storage Use

TODO: insert chart

## Results - System Age

TODO: insert figures

- Monolithic architectures most likely to have systems between 6-10 years or 11-20 years old.

- IT-Only teams less likely to have systems older than 20 years compared to Stream Aligned teams.

- By far most common answer for Other Mix teams is system age between 6-10 years.

## Results - Update Frequency

TODO: insert figures

- Non-trivial fraction of respondents never update the majority of systems 

- Monolithic systems more likely to never update than modular systems.

- IT-Only teams more likely to update systems frequently than other team types.

- Other Mix teams most likely to never update or update very infrequently.

- **All team types** reported multiple "never update" answers.

## Results - Number of Individuals

- Most NSOs require 2-3 individuals or 4-6 individuals to complete **small changes** and **large changes** to systems.

## Results - Lead Time

[Lead time](https://en.wikipedia.org/wiki/Lead_time): the amount of time required to get an end-to-end change to a CPI Production System implemented.

- Most NSOs reported lead time of "within 1 day" or "within 1 week" for **small changes** (a non-trivial fraction reported "within 1 month").

- Monolithic systems more likely to report "within 1 year" or "more than 1 year" for **large changes** compared to modular systems.

- Modular systems never reported "can't be modified" or "too complex" for the **large changes** lead time question.

- Stream-aligned teams and analyst-only teams were most likely to report "within 1 month" for **large changes** compared to any other answer.

## Results - Alternative Data Usage

- Almost 2/3 of respondents don't use Alternative Data Sources (ADS) at all.

- Of those who use ADS, their CPIs are comprised of "less than 10%" or "between 10% and 30%" alternative data by expenditure weight.

- Of those respondents who do not use ADS, most of them would like "between 10% and 30%" or "between 30% and 50%" of their CPI to be comprised of alternative data by expenditure weight.

## Results - Alternative Data Challenges

In the following order, the most commonly cited ADS challenges are:

1. Lack of data provider cooperation

2. Insufficient capacity

3. Insufficient technical skills to make use of ADS

4. Lack of methodology knowledge to make use of ADS

5. Appropriate data are not available

## Results - System Development Challenges (In General)

In the following order, the most commonly cited challenges are:

1. Lack of staff

2. Insufficient technical skills

3. Managing complexity of system interactions (e.g., passing data between systems)

4. Managing complexity of the system itself (e.g., managing a complex codebase)

5. Verifying the correct behaviour of a system

## Practical Suggestions

- Think explicitly about system boundaries.

- Think explicitly about data interchange between systems.

- Embed technical expertise in business domain teams.

- Version control all the things.

- Practice updating systems more frequently.

## Future Work

Two main follow-questions from our survey.

1. Effectively managing the complexity of CPI Production Systems **in practice** is far from a solved problem, despite viable solutions existing for all of the component problems. **How can this gap be bridged**?

2. Are lessons about system architecture and team organization from software engineering applicable to complex analytical systems like the CPI Production Systems studied in this survey?

## References {.unnumbered}

::: {#refs}
:::
